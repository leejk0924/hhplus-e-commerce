# 🏠 E-커머스 서비스

## 설계 문서
- [1. 요구사항명세서](/docs/1.Requireements.md)
- [2. ERD](/docs/2.ERD.md)
- [2-1 DDL](/src/main/resources/schema.sql)
- [3. 시퀀스 다이어그램](/docs/3.SequenceDiagram.md)
- [4. API명세](/docs/4.APISpec.png)

## 🚨 정책
- 인기상품은 최근 3일간 가장 많이 팔린 상품 5개 제품을 보여준다.
- 포인트는 최대 1000만원, 최소 0원을 보유할 수 있으며, 사용전 미리 충전된 상태여야 한다.
- 포인트를 통해 상품을 결제할 수 있으며, 결제 시 보유하고 있는 쿠폰을 먼저 적용하고, 그 차액을 포인트에서 차감하고, 데이터 플랫폼에 전송 한다.
- 해당 쿠폰은 전체 주문 금액에 대한 할인 혜택을 부여 받는다.
- 쿠폰은 3가지 상태를 가진다. [발급됨, 사용됨, 만료됨]
- 쿠폰은 2가지 할인 타입을 가진다. [고정 / 비율]
- 한 유저는 동일한 쿠폰을 여러개 가질 수 없다.
- 쿠폰은 선착순으로 발급 받을 수 있으며, 발급 받은 쿠폰의 사용기한은 발급 받은 날로부터 3일 이내이다.
- 결제 요청 1건에 1개의 쿠폰만 사용 가능하다.

## 🔫 추가/변경 가능성 있기에 확장 가능하도록 설계해야할 부분
- 쿠폰의 요금 정책/할인 정책이 얼마든지 변경 가능하다.
- 현재는 주문 취소 기능이 없으나, 추후 주문 취소 기능을 추가할 수 있다. (결제 상태 컬럼 추가 [주문 완료], [결제 완료], [결제 취소] 상태가 추가)
- 상품의 재고 확인을 위하여 설정한 수치 이하로 재고가 떨어질 경우 재고 알림이 발생하도록 한다.

## 🧾 상세 요구사항
### 포인트 (Point)
🛠️ 기능적 요구사항
#### 포인트 조회
- [ ] 사용자 검증
- [ ] 잔액이 없는 경우, 0을 반환
- [ ] 보유하고 있는 포인트 조회

#### 포인트 충전
- [ ] 사용자 검증
- [ ] 충전 후 보유 포인트는 0원 이상, 1000만원 이하 이다.
- [ ] 1회 최대 충전금액은 500만원 이다.
- [ ] 잔액 충전 완료 후 포인트 사용/충전 이력 저장

🖥️비기능적 요구사항
- [ ] 포인트 충전 시 트랜잭션은 원자성, 일관성 유지
- [ ] 동시 충전 시, 첫 번째 요청만 승인 후 나머지 요청은 무시한다. (Idempotency Key)

### 상품 (Product)
🛠️ 기능적 요구사항
#### 상품 조회
- [ ] 상품 정보를 조회한다.
- [ ] 상품의 재고 정보 관리

#### 인기상품 조회
- [ ] 최근 3일간 가장 많이 팔린 제품 5개를 조회한다.

🖥️비기능적 요구사항
- [ ] 인기상품은 자주 조회될 것으로 예상되어 캐시 사용 고려
- [ ] 인기상품의 매 12시간 간격으로 데이터를 수집을 수행한다.
- [ ] 최근 3일간 판매 순위 상위 5개 상품을 1초를 초과하지 않아야 한다.

### 쿠폰 (Coupon)
🛠기능적 요구사항
#### 쿠폰 선착순 발급
- [ ] 사용자 검증
- [ ] 발급된 쿠폰의 잔여 수량 확인
- [ ] 이미 발급된 쿠폰인지 확인

🖥️비기능적 요구사항
- [ ] 쿠폰의 선착순 발급에 대한 DoS 공격 방지 방안.
- [ ] 동시에 쿠폰 발급 요청이 들어올 시 동시성 제어를 통한 순번 보장
- [ ] 중복 요청 방지 (동일한 ID로 2개 이상의 쿠폰을 받을 수 없다.)

### 결제 (Order)
🛠기능적 요구사항
#### 상품 주문
- [ ] 사용자 검증
- [ ] 사용자로부터 입력 받은 상품 목록 확인 (상품 ID 존재 유무, 재고 수량 확인)

#### 상품 결제
- [ ] 사용자 검증
- [ ] 쿠폰 사용 시 쿠폰의 할인 타입에 따라 다르게 할인 금액 적용 (비율 / 고정 금액)
- [ ] 비율 할인 쿠폰 사용 시 전체 금액에서 최대 할인 금액과 최소 할인 금액이 유효한 범위에 있는지 확인
- [ ] 보유하고 있는 포인트로 결제할 가능 여부, 포인트 차액 반환
- [ ] 결제 완료 시 데이터 분석을 위해 주문 정보를 데이터 플랫폼(Mock API)에 전송

🖥️비기능적 요구사항
- [ ] 주문/결제 실패 시, 트랜잭션 보장
- [ ] 상품 주문 동시 요청 시 동시성 제어를 통해 순번 보장 

